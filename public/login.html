<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="/static/css/common.css"/>
  <link rel="stylesheet" href="/css/style.css"/>
  <title>Login / Register</title>
  <style>
    :root { --brand:#03A88F; }
    body { background:#f7f9f9; font-family: var(--font, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial); }
    .auth-wrap{max-width:960px;margin:64px auto;padding:24px;background:#fff;border-radius:16px;border:1px solid #e9efee;box-shadow:0 10px 30px rgba(0,0,0,.06)}
    .brand-bar{background:var(--brand);color:#fff;border-radius:12px;padding:16px 20px;margin-bottom:20px;display:flex;align-items:center;justify-content:space-between}
    .brand-bar a{color:#fff;text-decoration:none}
    .auth-grid{display:grid;grid-template-columns:1fr 1fr;gap:24px}
    .card{border:1px solid #e6eeee;border-radius:12px;padding:20px}
    .btn-brand{background:var(--brand);color:#fff;border:none;height:44px;border-radius:8px;cursor:pointer}
    .btn-brand:hover{filter:brightness(.95)}
    .muted{color:#667;font-size:.9rem}
    label{display:block;margin:6px 0}
    input{height:44px;width:100%;padding:10px;border:1px solid #d8e4e2;border-radius:8px;outline:none}
    input:focus{border-color:var(--brand);box-shadow:0 0 0 3px rgba(3,168,143,.15)}
    .link{color:var(--brand);text-decoration:underline;cursor:pointer}
    .w-100{width:100%}
    .mb-3{margin-bottom:12px}
    .mt-3{margin-top:12px}
    .error{background:#ffeef0;color:#b00020;border:1px solid #ffccd2;padding:10px;border-radius:8px;margin-bottom:12px;display:none}
    .ok{background:#e9fff7;color:#055b4a;border:1px solid #c7f5ea;padding:10px;border-radius:8px;margin-bottom:12px;display:none}
    @media (max-width:800px){.auth-grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="auth-wrap">
    <div class="brand-bar">
      <a href="/index.html">← Back to Home</a>
      <strong>Baenephit</strong>
    </div>

    <div class="auth-grid">
      <!-- LOGIN -->
      <div class="card" id="loginCard">
        <h3>Login</h3>
        <p class="muted">Welcome back!</p>
        <div id="loginMsg" class="error"></div>
        <form id="loginForm" novalidate>
          <div class="mb-3">
            <label for="loginEmail">Email</label>
            <input id="loginEmail" type="email" autocomplete="email" required />
          </div>
          <div class="mb-3">
            <label for="loginPassword">Password</label>
            <input id="loginPassword" type="password" autocomplete="current-password" required />
          </div>
          <button class="btn-brand w-100" type="submit">Login</button>
        </form>
        <p class="mt-3">New here? <span id="swapToRegister" class="link">Create an account</span></p>
      </div>

      <!-- REGISTER -->
      <div class="card" id="registerCard" style="display:none">
        <h3>Create account</h3>
        <p class="muted">Join Baenephit and start saving</p>
        <div id="regMsg" class="error"></div>
        <div id="regOk" class="ok"></div>
        <form id="registerForm" novalidate>
          <div class="mb-3">
            <label for="regName">Full name</label>
            <input id="regName" required />
          </div>
          <div class="mb-3">
            <label for="regEmail">Email</label>
            <input id="regEmail" type="email" autocomplete="email" required />
          </div>
          <div class="mb-3">
            <label for="regPassword">Password</label>
            <input id="regPassword" type="password" autocomplete="new-password" required />
          </div>
          <button class="btn-brand w-100" type="submit">Create account</button>
        </form>
        <p class="mt-3">Already have an account? <span id="swapToLogin" class="link">Login</span></p>
      </div>
    </div>
  </div>

  <script>
    // Simple helpers
    const show = (el, txt, klass="error") => {
      const box = document.getElementById(el);
      box.className = klass;
      if (txt) box.textContent = txt;
      box.style.display = "block";
    };
    const hide = (el) => { const box = document.getElementById(el); box.style.display = "none"; };

    // Toggle cards
    document.getElementById("swapToRegister").addEventListener("click", () => {
      document.getElementById("loginCard").style.display = "none";
      document.getElementById("registerCard").style.display = "block";
    });
    document.getElementById("swapToLogin").addEventListener("click", () => {
      document.getElementById("registerCard").style.display = "none";
      document.getElementById("loginCard").style.display = "block";
    });

    // REGISTER
    document.getElementById("registerForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      hide("regMsg"); hide("regOk");

      const name = document.getElementById("regName").value.trim();
      const email = document.getElementById("regEmail").value.trim();
      const password = document.getElementById("regPassword").value;

      if (!name || !email || !password) {
        show("regMsg", "Please fill all fields.");
        return;
      }

      try {
        const res = await fetch("/api/auth/register", {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({ name, email, password })
        });
        const data = await res.json();
        if (!res.ok) {
          show("regMsg", data.error || "Registration failed.");
          return;
        }
        // Save and go home
        localStorage.setItem("authToken", data.token);
        localStorage.setItem("userName", data.user?.name || name);
        window.location.href = "/index.html";
      } catch (err) {
        show("regMsg", "Network error. Please try again.");
      }
    });

    // LOGIN
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      hide("loginMsg");
      const email = document.getElementById("loginEmail").value.trim();
      const password = document.getElementById("loginPassword").value;

      if (!email || !password) {
        show("loginMsg", "Please enter email and password.");
        return;
      }

      try {
        const res = await fetch("/api/auth/login", {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({ email, password })
        });
        const data = await res.json();
        if (!res.ok) {
          show("loginMsg", data.error || "Invalid credentials.");
          return;
        }
        localStorage.setItem("authToken", data.token);
        localStorage.setItem("userName", data.user?.name || "");
        window.location.href = "/index.html";
      } catch (_) {
        show("loginMsg", "Network error. Please try again.");
      }
    });
  </script>
</body>
</html>
